{% extends "base.html" %}
{% block content %}
<h3 class="mb-3">Monthly Reports</h3>
<div class="card shadow-sm border-0 mb-4">
  <div class="card-body">
    <form method="post" class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Truck</label>
        <select name="truck_id" class="form-select" required>
          <option value="">Select...</option>
          {% for t in trucks %}
          <option value="{{ t.id }}" {% if selected_truck_id and selected_truck_id|int == t.id %}selected{% endif %}>{{ t.number }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Month</label>
        <select name="month" class="form-select" required>
          <option value="">Select...</option>
          {% for m in range(1,13) %}
          <option value="{{ m }}" {% if selected_month and selected_month|int == m %}selected{% endif %}>{{ "%02d"|format(m) }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Year</label>
        <input type="number" name="year" class="form-control" value="{{ selected_year or now.year }}" required>
      </div>
      <div class="col-md-12">
        <button type="submit" class="btn btn-primary">Search</button>
      </div>
    </form>
  </div>
</div>

{% if entries %}
<div class="d-flex justify-content-between align-items-center mb-2">
  <h5 class="mb-0">Results</h5>
  <a class="btn btn-sm btn-outline-primary" href="{{ url_for('reports_pdf', truck_id=selected_truck_id, month=selected_month, year=selected_year) }}">Download PDF</a>
</div>
<div class="table-responsive">
  <table class="table table-striped table-hover align-middle">
    <thead class="table-light">
      <tr>
        <th>Date</th>
        <th>Truck</th>
        <th>Driver</th>
        <th>Main</th>
        <th>Type</th>
        <th>Amount ($)</th>
      </tr>
    </thead>
    <tbody>
      {% for e in entries %}
      <tr>
        <td>{{ e.date }}</td>
        <td>{{ e.truck_number }}</td>
        <td>{{ e.driver_name }}</td>
        <td>{{ e.main_category }}</td>
        <td>{{ e.sub_category }}</td>
        <td>{{ "%.2f"|format(e.amount) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<div class="mt-3">
  <p><strong>Total Income:</strong> ${{ "%.2f"|format(total_income) }}</p>
  <p><strong>Total Expenses:</strong> ${{ "%.2f"|format(total_expense) }}</p>
  <p><strong>Net Income:</strong>
    {% if net_income >= 0 %}
      <span class="text-success">${{ "%.2f"|format(net_income) }}</span>
    {% else %}
      <span class="text-danger">${{ "%.2f"|format(net_income) }}</span>
    {% endif %}
  </p>
</div>
{% endif %}
{% endblock %}
